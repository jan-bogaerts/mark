
import React from 'react';
import { Tabs } from 'antd';
import { GptService } from '../../../services/gpt_service/GptService';
import { DialogService } from '../../../services/dialog_service/DialogService';
import ResultsViewTab from './results_view_tab/ResultsViewTab';

/**
 * ResultsView component
 * This component is used to display the results generated by the transformers
 * registered with the GptService for the currently selected text block.
 */
class ResultsView extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      transformers: [],
      selectedTransformer: null,
    };
  }

  componentDidMount() {
    this.getTransformers();
  }

  /**
   * Fetches the list of transformers from the GptService
   */
  getTransformers() {
    GptService.getTransformers()
      .then(transformers => {
        this.setState({ transformers });
      })
      .catch(error => {
        DialogService.showErrorDialog('Error fetching transformers', error);
      });
  }

  /**
   * Handles the selection of a transformer tab
   * @param {string} key - The key of the selected tab
   */
  handleTabChange(key) {
    this.setState({ selectedTransformer: key });
  }

  render() {
    const { TabPane } = Tabs;
    const { transformers, selectedTransformer } = this.state;

    return (
      <div className="results-view">
        <Tabs onChange={key => this.handleTabChange(key)} activeKey={selectedTransformer}>
          {transformers.map(transformer => (
            <TabPane tab={transformer.name} key={transformer.id}>
              <ResultsViewTab transformer={transformer} />
            </TabPane>
          ))}
        </Tabs>
      </div>
    );
  }
}

export default ResultsView;
